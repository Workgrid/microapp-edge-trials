{"version":3,"sources":["components/Debugger.js","components/Tests.js","pages/Summary.js","pages/FeaturePolicyDetail.js","pages/Tests.js","App.js","index.js"],"names":["className","onClick","window","location","reload","testTypes","name","inDetail","microapp","panel","useState","map","testType","inSummary","loading","result","tests","setTests","testActions","useRef","useEffect","testToken","current","Token","Title","testTitle","Show","testShow","Hide","testHide","updateTest","update","prevTests","test","setTimeout","a","getToken","token","process","decodedToken","decode","aud","console","warn","updateTitle","Math","floor","random","showDetail","url","origin","pathname","hideDetail","filter","key","aria-label","role","testName","Summary","MicroApp","id","audience","initialize","version","Tests","type","placeholder","Debugger","detailPage","title","Detail","navigator","isGeoAvailable","mediaDevices","isMicAvailable","locationData","setLocationData","isMicOn","setIsMicOn","JSON","stringify","tabIndex","geolocation","getCurrentPosition","position","coords","latitude","longitude","err","prev","App","basename","path","exact","component","FeaturePolicyDetail","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.03de00eb.chunk.js","sourcesContent":["import React from 'react'\n\nexport default () => {\n  return (\n    <>\n      <button className=\"secondary\" onClick={() => window.location.reload(true)}>\n        Refresh\n      </button>\n    </>\n  )\n}\n","import React, { useState, useEffect, useRef } from 'react'\nimport { decode } from 'jsonwebtoken'\n\nconst testTypes = [{ name: 'Token' }, { name: 'Title' }, { name: 'Show', inDetail: false }, { name: 'Hide' }]\n\nexport default ({ microapp, panel = 'summary' }) => {\n  const [tests, setTests] = useState(\n    testTypes.map(testType => ({ inSummary: true, inDetail: true, loading: false, result: false, ...testType }))\n  )\n  const testActions = useRef({})\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => testToken(), [microapp])\n\n  useEffect(() => {\n    testActions.current.Token = testToken\n    testActions.current.Title = testTitle\n    testActions.current.Show = testShow\n    testActions.current.Hide = testHide\n  })\n\n  const runTest = testName => () => {\n    testActions.current[testName]()\n  }\n\n  const updateTest = (name, update) => {\n    setTests(prevTests => {\n      return prevTests.map(test => {\n        if (test.name === name) {\n          return { ...test, ...update }\n        } else {\n          return test\n        }\n      })\n    })\n  }\n\n  const testToken = () => {\n    if (!microapp) return\n\n    updateTest('Token', { loading: true, result: false })\n    // Arbitrarily add a \"loading time\" other wise you are kind of \"did it work?\"\n    setTimeout(async () => {\n      const token = await microapp.getToken()\n      // This would be done on a server side, notice how I'm not verifying the token\n      const decodedToken = decode(token)\n      // TODO alter this verification when this app is upgraded to the more secure token\n      if (decodedToken.aud === process.env.REACT_APP_AUD) {\n        updateTest('Token', { loading: false, result: true })\n      } else {\n        updateTest('Token', { loading: false, result: false })\n        console.warn(`Invalid token: ${decodedToken.aud} !== ${process.env.REACT_APP_AUD}`)\n      }\n    }, 500)\n  }\n\n  const testTitle = () => {\n    updateTest('Title', { result: false })\n    microapp.updateTitle(`Title Change: ${Math.floor(Math.random() * 500)}`)\n    updateTest('Title', { result: true })\n  }\n\n  const testShow = () => {\n    updateTest('Show', { result: false })\n    microapp.showDetail({ url: `${window.location.origin}${window.location.pathname}#/tests` })\n    updateTest('Show', { result: true })\n  }\n\n  const testHide = () => {\n    updateTest('Hide', { result: false })\n    microapp.hideDetail()\n    updateTest('Hide', { result: true })\n  }\n\n  return (\n    <>\n      <strong>Tests:</strong>\n      {tests\n        .filter(test => (panel === 'summary' && test.inSummary) || (panel === 'detail' && test.inDetail))\n        .map(test => (\n          <div className=\"checklist\" key={test.name}>\n            {test.loading ? (\n              <span aria-label=\"loading\" role=\"img\" className=\"pass\">\n                ü§î\n              </span>\n            ) : (\n              <>\n                {test.result ? (\n                  <span aria-label=\"pass\" role=\"img\" className=\"pass\">\n                    ‚úÖ\n                  </span>\n                ) : (\n                  <span aria-label=\"fail\" role=\"img\" className=\"pass\">\n                    ‚ùå\n                  </span>\n                )}\n              </>\n            )}\n            <div className=\"item\">{test.name}</div>\n            <div className=\"item\">\n              <button className=\"action-small\" onClick={runTest(test.name)}>\n                Run\n              </button>\n            </div>\n          </div>\n        ))}\n    </>\n  )\n}\n","import React, { useRef, useEffect } from 'react'\nimport MicroApp from '@workgrid/micro-app'\nimport Debugger from '../components/Debugger'\nimport './summary.css'\n\nimport { version } from '../../package.json'\nimport Tests from '../components/Tests'\n\nconst Summary = () => {\n  const microapp = useRef(\n    new MicroApp({\n      id: 'edge-microapp-local',\n      audience: 'edge-microapp'\n    })\n  )\n\n  useEffect(() => {\n    microapp.current.initialize()\n  }, [])\n\n  const showDetail = detailPage => {\n    // We have to use the hash router to show detail due to Github pages limitations\n    microapp.current.showDetail({\n      url: `${window.location.origin}${window.location.pathname}#/${detailPage}`,\n      title: 'Edge Microapp'\n    })\n  }\n\n  return (\n    <div>\n      <h1>Edge Microapp</h1>\n      <p>This is the \"edgy\" microapp v{version}</p>\n      <section className=\"section\">\n        <Tests panel=\"summary\" microapp={microapp.current} />\n        <input type=\"text\" placeholder=\"Input Test\"></input>\n      </section>\n      <div className=\"action-block vertical\">\n        <Debugger />\n        <button className=\"primary\" onClick={() => showDetail('featurepolicy')}>\n          Feature Policy\n        </button>\n      </div>\n    </div>\n  )\n}\n\nexport default Summary\n","import React, { useRef, useEffect, useState } from 'react'\nimport MicroApp from '@workgrid/micro-app'\nimport './detail.css'\n\nconst Detail = () => {\n  const microapp = useRef(\n    new MicroApp({\n      id: 'edge-microapp',\n      audience: 'edge-microapp'\n    })\n  )\n\n  const [isGeoAvailable] = useState('geolocation' in navigator)\n  const [isMicAvailable] = useState(!!navigator.mediaDevices)\n  const [locationData, setLocationData] = useState('Get location data >>')\n  const [isMicOn, setIsMicOn] = useState(false)\n\n  useEffect(() => {\n    microapp.current.initialize()\n  }, [])\n\n  const getLocationData = () => {\n    if (isGeoAvailable) {\n      setLocationData('Getting location data')\n      try {\n        navigator.geolocation.getCurrentPosition(position => {\n          setLocationData(`lat: ${position.coords.latitude}, lon: ${position.coords.longitude}`)\n        })\n      } catch (err) {\n        setLocationData('Error fetching location data')\n      }\n    } else {\n      setLocationData('Geolocation is not available')\n    }\n  }\n\n  return (\n    <div className=\"container\">\n      <h1>Feature Policy Detail</h1>\n      <p>\n        This detail attempts to get location data. You must include the featurePolicy in the catalog entry for this app.\n      </p>\n      <div className=\"example-block\">\n        <p>GeoLocation is available: {JSON.stringify(isGeoAvailable)}</p>\n        <div className=\"feature-block\">\n          <pre>{locationData}</pre>\n          <div tabIndex=\"0\" className=\"feature-icon\" onClick={getLocationData}>\n            <span role=\"img\" aria-label=\"position\">\n              üß≠\n            </span>\n          </div>\n        </div>\n        <p>Media is available: {JSON.stringify(isMicAvailable)}</p>\n        <div className=\"feature-block\">\n          {isMicAvailable && (\n            <div tabIndex=\"1\" className=\"feature-icon\" onClick={() => setIsMicOn(prev => !prev)}>\n              <span role=\"img\" aria-label=\"mic\" className={isMicOn ? 'on' : 'off'}>\n                üéôÔ∏è\n              </span>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Detail\n","import React, { useRef, useEffect, useState } from 'react'\nimport MicroApp from '@workgrid/micro-app'\nimport './detail.css'\nimport Tests from '../components/Tests'\n\nconst Detail = () => {\n  const microapp = useRef(\n    new MicroApp({\n      id: 'edge-microapp',\n      audience: 'edge-microapp'\n    })\n  )\n\n  return (\n    <div className=\"container\">\n      <h1>Tests in Detail</h1>\n      <div className=\"example-block\">\n        <Tests microapp={microapp.current} panel={'detail'} />\n      </div>\n    </div>\n  )\n}\n\nexport default Detail\n","import React from 'react'\nimport { HashRouter as Router, Route } from 'react-router-dom'\n\nimport Summary from './pages/Summary'\nimport FeaturePolicyDetail from './pages/FeaturePolicyDetail'\nimport Tests from './pages/Tests'\n\nconst App = () => {\n  return (\n    <Router basename={window.location.pathname}>\n      <Route path=\"/\" exact component={Summary} />\n      <Route path=\"/featurepolicy\" component={FeaturePolicyDetail} />\n      <Route path=\"/tests\" component={Tests} />\n    </Router>\n  )\n}\n\nexport default App\n","import 'core-js/stable'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}