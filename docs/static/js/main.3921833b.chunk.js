(window["webpackJsonp@workgrid/microapp-edge-trials"]=window["webpackJsonp@workgrid/microapp-edge-trials"]||[]).push([[0],{240:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=240},242:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=242},252:function(e,t,n){},261:function(e,t,n){e.exports=n(594)},458:function(e,t,n){},463:function(e,t){},465:function(e,t){},503:function(e,t){},504:function(e,t){},560:function(e,t,n){var r,a,i;!function(o){if("object"===typeof e.exports){var s=o(n(240),t);void 0!==s&&(e.exports=s)}else a=[n,t],void 0===(i="function"===typeof(r=o)?r.apply(t,a):r)||(e.exports=i)}((function(e,t){"use strict";t.__esModule=!0,t.default=function(){var e=[];return{queue:e,push:function(t){e.flushed?t():e.push(t)},flush:function(){e.flushed=!0,e.map((function(e){return e()}))}}}}))},561:function(e,t,n){(function(r){var a,i,o;!function(r){if("object"===typeof e.exports){var s=r(n(242),t);void 0!==s&&(e.exports=s)}else i=[n,t,n(151),n(562),n(563),n(564),n(565),n(241),n(152)],void 0===(o="function"===typeof(a=r)?a.apply(t,i):a)||(e.exports=o)}((function(e,t){"use strict";t.__esModule=!0;var n=e("tslib"),a=n.__importDefault(e("./emitter")),i=n.__importDefault(e("nice-try")),o=n.__importDefault(e("debug/dist/debug")),s=n.__importDefault(e("uuid/v4")),u=n.__importDefault(e("ms")),c=e("lodash"),l=o.default("courier"),f=function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},d=function(){function e(e){var t=this,o=void 0===e?{}:e,d=o.timeout,p=o.sources,m=o.hosts,h=o.id;this.setup=function(){t.debug("setup",{}),t.hosts.forEach((function(e){e.addEventListener("message",t.handleMessage)}))},this.teardown=function(){t.debug("teardown",{}),t.hosts.forEach((function(e){e.removeEventListener("message",t.handleMessage)}))},this.register=function(e){t.debug("register",{source:e}),e&&(e=i.default((function(){return e.contentWindow}))||e,c.includes(t.sources,e)||t.sources.push(e))},this.unregister=function(e){t.debug("unregister",{source:e}),e&&(e=i.default((function(){return e.contentWindow}))||e,t.sources.splice(t.sources.indexOf(e)>>>0,1))},this.on=function(e,n){t.debug("on",{type:e,handler:n}),t.emitter.on(e,n)},this.off=function(e,n){t.debug("off",{type:e,handler:n}),t.emitter.off(e,n)},this.emit=function(e){var n=e.type,r=e.payload,a=e.target;t.debug("emit",{type:n,payload:r,target:a});var i={type:n,payload:r};t.sendMessage(i,a)},this.send=function(e){var n=e.type,a=e.payload,i=e.target,o=e.timeout;t.debug("send",{type:n,payload:a,target:i,timeout:o});var u={id:s.default(),type:n,payload:a},c={data:u};return new Promise((function(e,n){var a=setTimeout((function(){t.internal.off(u.id),n(t.error("APP-14",{event:c}))}),o||t.timeout);t.internal.on(u.id,(function(r,i){if(clearTimeout(a),t.internal.off(u.id),!r)return e(i);n(t.error("APP-16",{event:c,error:r,data:i}))}));var s=[];if("MessageChannel"in r){var l=new MessageChannel;l.port1.onmessage=function(e){t.debug("onmessage",{event:e,target:i,channel:l}),t.handleMessage({data:e.data,source:i})},s=[l.port2]}t.sendMessage(u,i,s)}))},this.error=function(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];t.debug("error",{code:e,args:r});var i=new Error(e);return c.assign.apply(void 0,n.__spread([i],r)),t.emitter.emit("error",i),i},this.sendMessage=function(e,n,r){t.debug("sendMessage",{data:e,target:n}),n=n||t.sources[0];var a=i.default((function(){return f(n,"MessagePort")}))||!1;if(!a&&!c.includes(t.sources,n))throw t.error("APP-13",{target:n});try{a?(t.debug("postMessage",{target:n,data:e}),n.postMessage(JSON.stringify(e))):(t.debug("postMessage",{target:n,data:e,transfer:r}),n.postMessage(JSON.stringify(e),"*",r))}catch(o){throw t.error("APP-12",{error:o,target:n,transfer:r})}},this.handleMessage=function(e){if(t.debug("handleMessage",{event:e}),e.source&&!c.includes(t.sources,e.source))return t.error("APP-15",{source:e.source});var r="nativeEvent"in e?e.nativeEvent.data:e.data;try{"string"===typeof r&&(r=JSON.parse(r))}catch(a){return t.error("APP-11",{error:a})}if(r&&r.parentId)t.internal.emit(r.parentId,r.error,r.payload);else{if(!r||!r.type)return t.error("APP-10",{event:e});t.emitter.invoke(r.type,(function(a){return n.__awaiter(t,void 0,void 0,(function(){var t,i,o,s;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,a({source:e.source,data:r})];case 1:return t=n.sent(),[3,3];case 2:return o=n.sent(),i=o,[3,3];case 3:return r.id?(s=e.ports&&e.ports[0]||e.source,this.sendMessage({parentId:r.id,payload:t,error:i},s),[2]):[2,this.debug("APP-17",{event:e,payload:t,error:i})]}}))}))}))}},this.debug=h?l.extend(h):l,this.debug("constructor",{timeout:d,sources:p,hosts:m}),this.timeout=d||u.default("10 seconds"),this.sources=p||[r.window.parent],this.hosts=m||[r.window],this.internal=a.default(),this.emitter=a.default(),this.setup()}return e.debug=o.default,e}();t.default=d}))}).call(this,n(20))},562:function(e,t,n){var r,a,i;!function(o){if("object"===typeof e.exports){var s=o(n(242),t);void 0!==s&&(e.exports=s)}else a=[n,t,n(151),n(152)],void 0===(i="function"===typeof(r=o)?r.apply(t,a):r)||(e.exports=i)}((function(e,t){"use strict";t.__esModule=!0;var n=e("tslib"),r=e("lodash");t.default=function(){var e=Object.create(null);return{listeners:e,on:function(t,n){e[t]=e[t]||[],e[t].push(n)},off:function(t,n){n?r.remove(e[t],(function(e){return e===n})):delete e[t]},emit:function(t){for(var a=[],i=1;i<arguments.length;i++)a[i-1]=arguments[i];r.map(e[t],(function(e){return e.apply(void 0,n.__spread(a))}))},invoke:function(t,n){r.map(e[t],(function(e){return n(e)}))}}}}))},588:function(e,t){},589:function(e,t,n){},594:function(e,t,n){"use strict";n.r(t);n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(94),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(324),n(325),n(326),n(327),n(328),n(329),n(331),n(333),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(356),n(357),n(360),n(361),n(362),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(185),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(447),n(448),n(449),n(450),n(453),n(194);var r=n(1),a=n.n(r),i=n(254),o=n.n(i),s=(n(458),n(258)),u=n(48),c=n(64),l=n.n(c),f=n(255),d=n(256),p=n(88),m=n(257);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var g=["Token","Title","Show","Hide"],v=function(e){var t=e.microapp,n=Object(r.useState)(g.map((function(e){return{name:e,result:!1}}))),i=Object(p.a)(n,2),o=i[0],s=i[1],u=Object(r.useRef)({});Object(r.useEffect)((function(){return v()}),[t]),Object(r.useEffect)((function(){u.current.Token=v,u.current.Title=b,u.current.Show=E,u.current.Hide=y}));var c=function(e,t){s((function(n){return n.map((function(n){return n.name===e?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{},t):n}))}))},v=function(){t&&(c("Token",{result:!1}),setTimeout(Object(f.a)(l.a.mark((function e(){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getToken();case 2:n=e.sent,"edge-microapp"===(r=Object(m.decode)(n)).aud?c("Token",{result:!0}):console.warn("Invalid token: ".concat(r.aud," !== ").concat("edge-microapp"));case 5:case"end":return e.stop()}}),e)}))),1e3))},b=function(){c("Title",{result:!1}),t.updateTitle("Title Change: ".concat(Math.floor(500*Math.random()))),c("Title",{result:!0})},E=function(){c("Show",{result:!1}),t.showDetail({url:"".concat(window.location.origin).concat(window.location.pathname,"#/tests")}),c("Show",{result:!0})},y=function(){c("Hide",{result:!1}),t.hideDetail(),c("Hide",{result:!0})};return a.a.createElement(a.a.Fragment,null,a.a.createElement("strong",null,"Tests:"),o.map((function(e){return a.a.createElement("div",{className:"checklist",key:e.name},e.result?a.a.createElement("span",{"aria-label":"pass",role:"img",className:"pass"},"\u2705"):a.a.createElement("span",{"aria-label":"fail",role:"img",className:"pass"},"\u274c"),a.a.createElement("div",{className:"item"},e.name),a.a.createElement("div",{className:"item"},a.a.createElement("button",{className:"action-small",onClick:(t=e.name,function(){u.current[t]()})},"Run")));var t})))},b=n(65),E=n.n(b),y=(n(589),function(){var e=Object(r.useRef)(new E.a({id:"edge-microapp",audience:"edge-microapp"}));Object(r.useEffect)((function(){console.log("Initialize"),e.current.initialize()}),[]);var t=function(t){console.log("Showing detail"),e.current.showDetail({url:"".concat(window.location.origin).concat(window.location.pathname,"#/").concat(t),title:"Edge Microapp"})};return a.a.createElement("div",null,a.a.createElement("h1",null,"Edge Microapp"),a.a.createElement("p",null,'This is the "edgy" microapp.'),a.a.createElement("section",{className:"section"},a.a.createElement("input",{type:"text",placeholder:"Input Test"}),a.a.createElement(v,{microapp:e.current})),a.a.createElement("div",{className:"action-block vertical"},a.a.createElement("button",{className:"secondary",onClick:function(){return t("iframe")}},"Inner iFrame"),a.a.createElement("button",{className:"primary",onClick:function(){return t("tests")}},"Detail Tests")))}),w=(n(252),function(){var e=Object(r.useRef)(new E.a({id:"edge-microapp",audience:"edge-microapp"})),t=Object(r.useState)(5),n=Object(p.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(""),u=Object(p.a)(s,2),c=u[0],l=u[1],f=Object(r.useRef)();return Object(r.useEffect)((function(){console.log("Initializing Detail"),e.current.initialize(),f.current=setInterval((function(){o((function(e){return console.log(e%2?"Tick":"Tock"),e-1}))}),1e3)}),[]),Object(r.useEffect)((function(){i<=0&&(l("https://www.catapultsgame.com/app/"),clearInterval(f.current))}),[i]),a.a.createElement("div",{className:"container"},a.a.createElement("h1",null,"IFrame Detail"),a.a.createElement("p",null,'Tests an inner iFrame. This is a typical use case for "wrapping" an existing app in a MicroApp.'),a.a.createElement("div",{className:"example-block"},a.a.createElement("p",null,"Showing iFrame in ",i,"s"),a.a.createElement("iframe",{style:{width:"100%",borderWidth:1},title:"Example Iframe",src:c})))}),_=function(){var e=Object(r.useRef)(new E.a({id:"edge-microapp",audience:"edge-microapp"}));return Object(r.useEffect)((function(){console.log("Initializing Detail"),e.current.initialize()}),[]),a.a.createElement("div",{className:"container"},a.a.createElement("h1",null,"Tests Detail"),a.a.createElement("div",{className:"example-block"},a.a.createElement(v,{microapp:e.current})))},O=function(){return a.a.createElement(s.a,{basename:window.location.pathname},a.a.createElement(u.a,{path:"/",exact:!0,component:y}),a.a.createElement(u.a,{path:"/tests",component:_}),a.a.createElement(u.a,{path:"/iframe",component:w}))};o.a.render(a.a.createElement(O,null),document.getElementById("root"))},65:function(e,t,n){var r,a,i;!function(o){if("object"===typeof e.exports){var s=o(n(240),t);void 0!==s&&(e.exports=s)}else a=[n,t,n(151),n(241),n(560),n(561),n(568),n(152),n(571),n(572)],void 0===(i="function"===typeof(r=o)?r.apply(t,a):r)||(e.exports=i)}((function(e,t){"use strict";t.__esModule=!0;var n=e("tslib"),r=n.__importDefault(e("ms")),a=n.__importDefault(e("./queue")),i=n.__importDefault(e("@workgrid/courier")),o=n.__importDefault(e("jwt-decode")),s=e("lodash"),u=n.__importDefault(e("resize-observer-polyfill")),c=n.__importDefault(e("p-any")),l={READY:"ready",ERROR:"error",SET_SIZE:"setSize",SHOW_DETAIL:"showDetail",HIDE_DETAIL:"hideDetail",UPDATE_TITLE:"updateTitle",REFRESH_TOKEN:"refreshToken"},f=r.default("10s"),d=r.default("100ms"),p=function(e){try{return o.default(e).exp<Date.now()/1e3}catch(t){return!0}},m=function(){return function(e){var t=this,r=e.audience,o=e.onError,m=e.id;if(this.initialize=function(){t.ready().then((function(){t.queue.flush(),t.subscribe()}))},this.subscribe=function(){return t.ro.observe(window.document.documentElement),t.unsubscribe},this.unsubscribe=function(){t.ro.disconnect()},this.handleResize=s.throttle((function(e){var n=e[0].target.offsetHeight;t.emit({type:l.SET_SIZE,payload:{height:n}})}),1e3),this.getToken=function(){return n.__awaiter(t,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return this.token&&!p(this.token)?[2,this.token]:(e=this,[4,this.send({type:l.REFRESH_TOKEN,payload:{audience:this.audience}})]);case 1:return[2,e.token=t.sent()]}}))}))},this.updateTitle=function(e){t.emit({type:l.UPDATE_TITLE,payload:{title:e}})},this.showDetail=function(e){var n=e.url,r=e.title;if(!n)throw new Error("URL is required to show details");t.send({type:l.SHOW_DETAIL,payload:{title:r,url:n}})},this.hideDetail=function(){t.send({type:l.HIDE_DETAIL})},this.emit=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.queue.push((function(){var r;(r=t.courier).emit.apply(r,n.__spread(e))}))},this.send=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new Promise((function(r,a){t.queue.push((function(){var i;(i=t.courier).send.apply(i,n.__spread(e)).then(r,a)}))}))},this.ready=function(e){void 0===e&&(e=1);var n={height:window.document.documentElement.offsetHeight},r=[t.courier.send({type:l.READY,payload:n})],a=setInterval((function(){r.push(t.courier.send({type:l.READY,payload:n})),++e>=f/d&&clearInterval(a)}),d);return c.default(r).then((function(){return clearInterval(a)}))},!r)throw new Error("Missing required parameter: options.audience");this.audience=r,this.id=m||r,this.courier=new i.default({id:this.id}),this.courier.on("error",o||function(){}),this.queue=a.default(),this.ro=new u.default(this.handleResize)}}();t.default=m}))}},[[261,1,2]]]);
//# sourceMappingURL=main.3921833b.chunk.js.map